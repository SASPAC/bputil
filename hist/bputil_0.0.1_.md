# Documentation for the `bpUTiL` package.
  
----------------------------------------------------------------
 
 *Basic Popular UTiLity programs* 
  
----------------------------------------------------------------
 
### Version information:
  
- Package: bpUTiL
- Version: 0.0.1
- Generated: 2024-12-03T16:37:17
- Author(s): Bartosz Jablonski (yabwon@gmail.com)
- Maintainer(s): Bartosz Jablonski (yabwon@gmail.com)
- License: MIT
- File SHA256: `F*EB9ADD68FB2537663EC1AF735E896F8F7D49E9E712391A3AE14086022508D3BD` for this version
- Content SHA256: `C*99C572492F27D0EFB360EDB4CE0263337D78A2ACDBD75620DABF4FD8A3EB63B7` for this version
  
---
 
# The `bpUTiL` package, version: `0.0.1`;
  
---
 

The `bpUTiL` package, supported by `basePlus` and `macroArray` packages,
provides a set of basic popular utility programs to make daily programming
work easier.

  
---
 
  
---
 
Required SAS Packages: 
  - basePlus (2.1.0)
  - macroArray (1.2.6)
  
---
 
 
--------------------------------------------------------------------
 
*SAS package generated by SAS Package Framework, version `20241129`*
 
--------------------------------------------------------------------
 
# The `bpUTiL` package content
The `bpUTiL` package consists of the following content:
 
1. [`bputil_int_oneliners` exec ](#bputilintoneliners-exec-1 )
2. [`bputil_int_oneliners` clean ](#bputilintoneliners-clean-2 )
3. [`%bputil_int_1varattrsds1()` macro ](#bputilint1varattrsds1-macro-3 )
4. [`%bputil_int_1varattrsds2()` macro ](#bputilint1varattrsds2-macro-4 )
5. [`%bputil_attributes()` macro ](#bputilattributes-macro-5 )
6. [`%bputil_convertn2c()` macro ](#bputilconvertn2c-macro-6 )
7. [`%bputil_includesasnotebook()` macro ](#bputilincludesasnotebook-macro-7 )
8. [`%bputil_varstoonecasesize()` macro ](#bputilvarstoonecasesize-macro-8 )
  
 
9. [License note](#license)
  
---
 
## `bputil_int_oneliners` exec <a name="bputilintoneliners-exec-1"></a> ######
A bunch of internal "one-liners" built with 
BasePlus `%GenerateOneLiners()` macro.

Those macros provided are convenience "wrappers" 
over the `%sysfunc(<someFunction>(...))` code.
Log from `bpUTiL` package loading shows detailed 
list of created macros.

Of course dedicated code cleaning those macros from SAS
session is executed when `bpUTiL` package is unloaded.

  
---
 
## `bputil_int_oneliners` clean <a name="bputilintoneliners-clean-2"></a> ######
Cleaning internal "one-liners" built with BasePlus `%GenerateOneLiners()` macro.
  
---
 
## `%bputil_int_1varattrsds1()` macro <a name="bputilint1varattrsds1-macro-3"></a> ######
An internal macro to extract attributes information about `i`-th variable 
from an `open()` data set with identifier `dsid`.

Dedicated for `DATA STEP` format.
  
---
 
## `%bputil_int_1varattrsds2()` macro <a name="bputilint1varattrsds2-macro-4"></a> ######
An internal macro to extract attributes information about `i`-th variable 
from an `open()` data set with identifier `dsid`.

Dedicated for `PROC DS2` format.
  
---
 
## `%bputil_attributes()` macro <a name="bputilattributes-macro-5"></a> ######

### DESCRIPTION: ##############################################################

The `bpUTiL_attributes()` macro allow for automatic variables attributes
extraction from a data set for a given list of variables and use them 
in your program. 

Generated code (depending on `type` parameter value) allows
to provide syntax for `data step` and for `proc ds2` attributes
definitions.

Idea for the macro was inspired by Stu Sztukowski's post:
https://www.linkedin.com/posts/statsguy_sastiptuesday-sas-programming-activity-7259609656396779521-YO1D?utm_source=share&utm_medium=member_desktop
and
https://github.com/stu-code/sas/blob/master/utility-macros/getattribs.sas
but with implementation done from scratch with macro language.


### SYNTAX: ###################################################################

The basic syntax is the following, the `<...>` means optional parameters:
~~~~~~~~~~~~~~~~~~~~~~~sas
%bpUTiL_attributes(
   ds
 <,vars=>
 <,type=>
 <,statement=>
 <,attrs=>
)
~~~~~~~~~~~~~~~~~~~~~~~

**Arguments description**:

1. `ds`    - *Required.* Valid data set name.
             No data set options can be used.

* `vars=`  - *Optional.* A list of variables for which 
             attributes should be extracted. Default
             value is `_ALL_` and means "use all variables".
             Can take any *standard* SAS data variables list
             format, e.g., `A B C`, `A1-A5`, `_NUMERIC_`,
             `A-character-C`, or mixture of those.

* `type=`  - *Optional.* Indicates what format should be used. 
             Allowed values are `1` and `2`. For any other value
             `type` is re-set to `1`.
             When `1` is used Data Step format with `ATTRIB ... ;`
             statement is generated.
             When `2` is used Proc DS2 format with `DCL ... ;`
             statement is generated.
             Default value is `1`

* `statement=` - *Optional.* Indicates if generated list of attributes
                 should be provided inside `ATTRIB/DCL` statement for 
                 direct use in Data step/Proc DS2 code, or without for 
                 example for information purpose in `%put` statement.
                 Default value is `1` and means "use `ATTRIB/DCL` statement".

* `attrs=` - *Optional.* A list of attributes to be extracted.
             The `length` is *always* extracted and provided.
             Default value is `format informat label` and means 
             "extract, if they exist, attributes for formats, informats, and label".

---


### EXAMPLES AND USECASES: ####################################################

**EXAMPLE 1.** Basic use case - extract all attributes:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
options mprint;
data _null_;
 %bpUTiL_attributes(sashelp.cars)
 call missing(of _all_);
run;
options nomprint;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**EXAMPLE 2.** Display attributes of `_nuimeric_` variables:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
%put %bpUTiL_attributes(sashelp.cars,vars=_numeric_);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**EXAMPLE 3.** Use explicit `ATTRIB` statement:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
data _null_;
ATTRIB
%bpUTiL_attributes(sashelp.cars
,vars=_numeric_
,statement=0)
;
run;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**EXAMPLE 4.** Data set with big number of variables:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
data AAA;
  ARRAY A A1 - A1024;
  format A1 - A1024 best17.;
  call missing(of A[*]);
run;

data BBB;
 %bpUTiL_attributes(AAA)

 ARRAY A A1 - A1024;
 call missing(of A[*]);
run;

proc compare base=AAA compare=BBB;
run;

data AAA;
  ARRAY A A1 - A1024;
  format A1 - A1024 best17.;
  call missing(of A[*]);
run;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**EXAMPLE 5.** Works with `PROC DS2` too:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
data cars;
  set sashelp.cars;
run;

%put %bpUTiL_attributes(sashelp.cars, type=2);

options Mprint;
proc ds2;
    data work.cars2 / overwrite=yes;

        %bpUTiL_attributes(sashelp.cars, type=2)

        method run();
            set cars;
        end;

    enddata;
    run;

quit;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

---

  
---
 
## `%bputil_convertn2c()` macro <a name="bputilconvertn2c-macro-6"></a> ######

### DESCRIPTION: ##############################################################

The `bpUTiL_convertN2C` macro converts a variable 
in the `Numeric <-> Character` fashion
and keeps variable original position in the data set.

Conversion is done "quiet" way, i.e., no conversion errors are 
displayed in the log. Hence if converted text is "not convertible"
result will be missing data. 

By default `best32.` is used for conversion, but 
other formats/informats can be used too, 
e.g., `yymmdd10.` to convert "date as text".

### SYNTAX: ###################################################################

The basic syntax is the following, the `<...>` means optional parameters:
~~~~~~~~~~~~~~~~~~~~~~~sas
%bpUTiL_attributes(
   ds
 <,vars=>
 <,type=>
 <,statement=>
 <,attrs=>
)
~~~~~~~~~~~~~~~~~~~~~~~

**Arguments description**:

1. `ds`    - *Required.* Valid data set name.
             No data set options can be used.

2. `vn`    - *Required.* Valid, space-separated 
             list of variables to convert.
             No variables lists can be used.

* `fmt=`   - *Optional.* Name of a format or informat 
             to use for conversion. Default is `best32.`,
             but other, like e.g., `yymmdd10.`, can be used.

---


### EXAMPLES AND USECASES: ####################################################

**EXAMPLE 1.** Convert single variable:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
data class(label="Test Label 1" compress=yes index=(name wh=(height weight)));
  set sashelp.class;
  label age = 'Variable with age and has %percents and &amps in it!!'
        sex = "Variable with sex";
  ;
run;

proc contents data=class;
run;

options MPRINT;
%bpUTiL_convertN2C(class, age)

ods select variables;
proc contents data=class;
run;

options MPRINT;
%bpUTiL_convertN2C(class, age)

ods select variables;
proc contents data=class;
run;

ods select all;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**EXAMPLE 2.** Convert multiple variables:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
data class2(label="Test Label 1" compress=yes index=(name wh=(height weight)));
  set sashelp.class;
  label age = 'Variable with age and has %percents and &amps in it!!'
        sex = "Variable with sex"
        weight = "Weight, but not in kilograms.";
  ;
run;

proc contents data=class2;
run;

options MPRINT;
%bpUTiL_convertN2C(class2, age weight)

ods select variables;
proc contents data=class2;
run;

options MPRINT;
%bpUTiL_convertN2C(class2, weight age XXX)

ods select variables;
proc contents data=class2;
run;

ods select all;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**EXAMPLE 3.** Convert date variable:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
data class3(label="Test Label 1" compress=yes index=(name wh=(height weight)));
  set sashelp.class;
  label age = 'Variable with age and has %percents and &amps in it!!'
        sex = "Variable with sex"
        weight = "Weight, but not in kilograms.";
  ;
  age_as_date = put("2feb2020"d+123*age,yymmdd10.);
run;

proc contents data=class3;
run;
proc print data=class3;
run;

options MPRINT;
%bpUTiL_convertN2C(class3, age_as_date, fmt=yymmdd10.)

ods select variables;
proc contents data=class3;
run;

ods select all;
proc print data=class3;
  format age_as_date date11.;
run;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

---

  
---
 
## `%bputil_includesasnotebook()` macro <a name="bputilincludesasnotebook-macro-7"></a> ######

### DESCRIPTION: ##############################################################

The `bpUTiL_includeSASNotebook` macro extracts SAS, SQL, and Python 
code snippets of arbitrary size (tested on a code block containing all 
SAS Packages Framework code) from a SAS Notebook `*.sasnb` file.

Macro works in two modes. By default, it extracts code and includes it in 
SAS session, just like: `%include "../code_extractersd_by_hand.sas";`. 
Alternatively, the macro just prints out all extracted code in the log.

For SQL nad Python code blocks prefixes and suffixes are added.
For SQL they are:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
PROC SQL;

...

QUIT:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For Python they are:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
PROC PYTHON;
SUBMIT;

...

ENDSUBMIT;
QUIT;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Idea for the macro was inspired by Chris Hemedinger's post:
https://communities.sas.com/t5/SAS-Viya-Workbench-Discussion/Weekly-Workbench-Tip-Run-a-SAS-Notebook-INCLUDE-style/m-p/943690
but with implementation done from scratch.


### SYNTAX: ###################################################################

The basic syntax is the following, the `<...>` means optional parameters:
~~~~~~~~~~~~~~~~~~~~~~~sas
%bpUTiL_includeSASNotebook(
   path
 <,print=>
)
~~~~~~~~~~~~~~~~~~~~~~~

**Arguments description**:

1. `path`    - *Required.* Valid path to SAS 
                Notebook `*.sasnb` file.

* `print=`    - *Optional.* Indicates weather notebook code
                should be printed (`1`) or included (`0`).
                The default is `0`.

---


### EXAMPLES AND USECASES: ####################################################

**EXAMPLE 1.** This prints out code from notebook in SAS log:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
%bpUTiL_includeSASNotebook(C:\notebooks\SASnotebook1.sasnb, print=1);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**EXAMPLE 2.** This `%include` code from notebook in SAS log:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
%bpUTiL_includeSASNotebook(~/SASnotebook2.sasnb);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

---

  
---
 
## `%bputil_varstoonecasesize()` macro <a name="bputilvarstoonecasesize-macro-8"></a> ######

### DESCRIPTION: ##############################################################

The `bpUTiL_VarsToOneCaseSize` macro converts all 
variables names in given dataset to "low case only" 
or to "UPCASE CASE ONLY", e.g., variables `Aa bb cC` 
are transformed into `aa bb cc` or `AA BB CC`, respectively.

### SYNTAX: ###################################################################

The basic syntax is the following, the `<...>` means optional parameters:
~~~~~~~~~~~~~~~~~~~~~~~sas
%VarsToOneCaseSize(
   libds
 <,case=>
)
~~~~~~~~~~~~~~~~~~~~~~~

**Arguments description**:

1. `libds`    - *Required.* Valid data set name.
                No data set options can be used.

* `case`    - *Optional.* Indicates weather the upper case (`U`) 
              or the lower case (`L`) transformation should be used.
              `L` is the default.

---


### EXAMPLES AND USECASES: ####################################################

**EXAMPLE 1.** Convert variables names:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
data class;
set sashelp.class;
run;
proc print data=class(obs=3);
run;

options mprint;
%bpUTiL_VarsToOneCaseSize(class) %* all to lowcase *;


proc print data=class(obs=3);
run;

options mprint;
%bpUTiL_VarsToOneCaseSize(work.class) %* no update done *;

proc print data=class(obs=3);
run;

options mprint;
%bpUTiL_VarsToOneCaseSize(work.class,case=U) %* all to upcase *;

proc print data=class(obs=3);
run;

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

### NOTES: ####################################################################

**NOTE 1.** Macro overcome the following issue too:
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~sas
data test;
  a=42;
run;

PROC DATASETS LIB=work NOLIST NOWARN;
MODIFY test;
  RENAME
    a=a      %* keep lower case - gives an error ;
  ;;;;
  RUN;
QUIT;

PROC DATASETS LIB=work NOLIST NOWARN;
MODIFY test;
  RENAME
    a=A     %* change to upper case - no error ;
  ;;;;
  RUN;
QUIT;

data test2;
  set test;
  rename a=a; %* no error in data step ;
run;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

---

  
---
 
  
---
 
# License <a name="license"></a> ######
 
Copyright (c) Bartosz Jablonski, since 2024

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
  
---
 
